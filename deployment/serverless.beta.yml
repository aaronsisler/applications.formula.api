service: formula-api

provider:
  name: aws
  runtime: nodejs12.x
  stage: beta
  region: us-east-1
  iam:
    role: arn:aws:iam::654918520080:role/APIG-LAMBDA-DDB
  apiGateway:
    usagePlan:
      quota:
        limit: 500
        offset: 0
        period: MONTH
      throttle:
        burstLimit: 20
        rateLimit: 10
    resourcePolicy:
      - Effect: Allow
        Principal: "*"
        Action: execute-api:Invoke
        Resource:
          - execute-api:/*/GET/*
          - execute-api:/*/POST/*
          - execute-api:/*/OPTIONS/*
        Condition:
          IpAddress:
            aws:SourceIp: ${file(./deployment/cors.json):ipRange}

functions:
  health:
    handler: dist/handlers/health-handler/index.handler
    description: Gateway health check. Responds with current time and a short message.
    events:
      - http:
          path: /health
          method: get
  user-post:
    handler: dist/handlers/user-post-handler/index.handler
    description: Create user.
    events:
      - http:
          path: /user
          method: post
  user-get:
    handler: dist/handlers/user-get-handler/index.handler
    description: Get a user.
    events:
      - http:
          path: /user/{userId}
          method: get
          request:
            parameters:
              paths:
                userId: true
  user-tenant-post:
    handler: dist/handlers/user-tenant-post-handler/index.handler
    description: Add tenant to user.
    events:
      - http:
          path: /user/tenant
          method: post
  user-tenant-get:
    handler: dist/handlers/user-tenant-get-handler/index.handler
    description: Get tenants for a user.
    events:
      - http:
          path: /user/tenant/{userId}
          method: get
          request:
            parameters:
              paths:
                userId: true

plugins:
  - serverless-domain-manager

custom:
  customDomain:
    domainName: formula.otterandcow.com
    basePath: "beta"
    stage: beta
    createRoute53Record: true
